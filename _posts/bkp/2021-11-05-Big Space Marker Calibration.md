---
layout: post
title: "大空间多Marker标定方法"
author: "gxyu"
---

### 1. 概述

大空间Marker生产和布置的过程中往往存在工艺上的误差和施工上的偏差，导致Marker的3D信息不理想。采用多目相机3D重建的方法，对场景中的多个Marker进行3D重建，可以得到相对准确的Marker 3D信息。重建后的3D信息可以更好的用于Marker的跟踪和大空间的融合算法。

多目相机的3D重建的基本思路是：首先将不同朝向的相机固定在一个刚体上，保证相机之间存在重叠区域。其次，对多目相机进行内参和外参的标定，得到相机的参数以及它们之间的相对关系。利用多目相机同时拍摄场景中的Marker，在场景中不断移动相机刚体，得到若干组Marker的图像集合。利用图像集合和相机参数，进行3D重建，并利用BA算法进行全局优化，得到准确的Marker 3D信息。

### 2. 多目相机标定

采集不同朝向和不同位置的棋盘格图像，利用多目相机标定工具标定相机内外参数。（已经完成）

由于该方案对相机之间的相对关系要求比较高，目前还不确定当前的标定精度是否可以满足要求。


### 3. 基于多目相机的Marker标定

基于多目相机的Marker标定，本质上是一个全局优化的Marker 3D重建过程，基本流程为：

**Step 1.** 在场景中选取若干个位置$P_1,P_2,...,P_n$。对于任意一个位置$P_i$；
**Step 2.** 用三目相机采集采集3张图像，记为$I_1,I_2,I_3$。分别计算出图像中的Marker相对于当前相机的Pose。根据相机外参，将左右相机跟踪到的结果转换到中间相机的坐标系下，将得到Marker相对于中间相机的Pose，记为$T_1,T_2,T_3$；
**Step 3.** 假设场景中有k个Marker，记为$M_1,M_2,...,M_k$。将$M_1$作为基准点，根据上一步得到的Marker的Pose，可以得到任意一个Marker相对于$M_1$的Pose。根据这个相对关系，重新计算所有Marker中的点在$M_1$确定的坐标系下的3D位置，这个结果作为初始标定结果；
**Step 4.** 重新采集更多位置的图像集，利用Step 3得到的初始标定结果，可以得到新的Pose集合和可见的3D-2D点的对应集合。将这些数据送到BA中，进行全局优化，得到优化后的Marker全局3D信息。

***注：相机之间的外参如果不准确，可以在BA的过程中，将相机外参也作为优化项，进行全局优化***




   



   

